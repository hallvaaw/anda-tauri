<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <title>Automated Neuronal Differentiation Analyzer</title>
        <link rel="stylesheet" href="cellParametersStyle.css">
</head>
<body>
    <h1>Create cell parameters input file</h1>
    <form action="">
        <div class="grid cell-line">
            <label for="aspect_ratio">Cell line</label>
            <input id="cell-type" class="numberinput" type="text" name="metrics" value=>
        </div>
        <section>
            <div id="cells">
                <div class="grid ar">
                    <label for="aspect_ratio">Min. cell size (px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" value=0>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Max. cell size(px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" value=0>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Min. cell circularity</label>
                    <input class="numberinput" type="number" name="metrics" value=0.00>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Max. cell circularity</label>
                    <input class="numberinput" type="number" name="metrics" value=1.00>
                </div>
            </div>
            <div id="neurites">
                <div class="grid ar">
                    <label for="aspect_ratio">Min. neurite size (px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" value=0>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Max. neurite size(px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" value=0>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Min. neurite circularity</label>
                    <input class="numberinput" type="number" name="metrics" value=0.00>
                </div>
                <div class="grid">
                    <label for="aspect_ratio">Max. neurite circularity</label>
                    <input class="numberinput" type="number" name="metrics" value=1.00>
                </div>
            </div>
        </section>
        <div class="btns">
            <a id="cancel" class="btn" href="index.html">Cancel</a>
            <a id="submit" class="btn" href="index.html">Submit</a>
            <button type="submit">submit</button>
        </div>
    </form>
</body>
<script>

const fs = window.__TAURI__.fs

function clearInput(e) {
    if (e.value == "0") {
        e.value = "";
    }
}

function refillInput(e) {
    if (e.value == "") {
        e.value = "0";
    }
}

// Write cell line parameters
function handleSubmit(e) {
    e.preventDefault();

    const cellType = document.getElementById("cell-type");
    cellType.classList.add("invalid");
    if (!cellType.value) {
        cellType.classList.add("invalid");    
    } else {
        const data = new FormData(e.target);
        const value = Object.fromEntries(data.entries());
        value.metrics = data.getAll("metrics");
        valueString = JSON.stringify(value);
        fs.writeFile("METRICS", valueString, function(err, result) {
            if(err) {
                console.log('error writing file')
            };
        });
    };
}

const form = document.querySelector('form');
form.addEventListener('submit', handleSubmit);



</script>
</html>
