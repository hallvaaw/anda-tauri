<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Automated Neuronal Differentiation Analyzer</title>
    <link rel="stylesheet" href="cellParametersStyle.css">
</head>
<body>
    <h1>Create cell parameters input file</h1>
    <form action="">
        <div class="cell-grid">
            <div class="grid cell-line">
                <label for="celltype">Cell line</label>
                <input id="cell-type" class="numberinput" type="text" name="metrics" value=>
            </div>
            <span class="visible">Please enter cell line</span>
        </div>
        <select id="dropdown">
            <option value="isodata">IsoData</option>
            <option value="triangle">Triangle</option>
            <option value="mean">Mean</option>
            <option value="minerror">MinError</option>
            <option value="maxentropy">MaxEntropy</option>
            <option value="yen">Yen</option>
            <option value="moment">Moment</option>
            <option value="li">Li</option>
            <option value="otsu">Otsu</option>
            <option value="renyientropy">RenyiEntropy</option>
            <option value="shanbhag">Shanbhag</option>
            <option value="huang">Huang</option>
            <option value="intermodes">Intermodes</option>
            <option value="triangle">Triangle</option>
        </select>
        <section>
            <div id="min">
                <div class="grid ar">
                    <label for="min-cell-size">Min. cell size (px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" min=0 value=0>
                </div>
                <div class="grid ar">
                    <label for="min-neurite-size">Min. neurite size (px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" min=0 value=0>
                </div>
                <div class="grid">
                    <label for="min-cell-circ">Min. cell circularity</label>
                    <input class="circularity" type="number" name="metrics" min=0 max=1 step=0.01 value=0.00>
                </div>
                <div class="grid">
                    <label for="min-neurite-circ">Min. neurite circularity</label>
                    <input class="circularity" type="number" name="metrics" min=0 max=1 step=0.01 value=0.00>
                </div>
            </div>
            <div id="max">
                <div class="grid">
                    <label for="max-cell-size">Max. cell size(px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" min=0 value=0>
                </div>
                <div class="grid">
                    <label for="max-neurite-size">Max. neurite size(px)</label>
                    <input class="numberinput" type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" name="metrics" min=0 value=0>
                </div>
                <div class="grid">
                    <label for="max-cell-circ">Max. cell circularity</label>
                    <input class="circularity" type="number" name="metrics" min=0 max=1 step=0.01 value=1.00>
                </div>
                <div class="grid">
                    <label for="max-neurite-circ">Max. neurite circularity</label>
                    <input class="circularity" type="number" name="metrics" min=0 max=1 step=0.01 value=1.00>
                </div>
            </div>
        </section>
        <div class="btns">
            <a id="cancel" class="btn" href="index.html">Cancel</a>
            <a id="submit" class="btn" href="index.html">Submit</a>
            <button type="submit">submit</button>
        </div>
    </form>
</body>
<script>

const fs = window.__TAURI__.fs

function clearInput(e) {
    if (e.value == "0") {
        e.value = "";
    }
}

function refillInput(e) {
    if (e.value == "") {
        e.value = "0";
    }
}

// Write cell line parameters
function handleSubmit(e) {
    e.preventDefault();

    const cellType = document.getElementById("cell-type");
    const errorSpan = document.querySelector("span");
    errorSpan.classList.add("invalid");
    cellType.classList.add("invalid");
    if (!cellType.value) {
        cellType.classList.add("invalid");    
    } else {
        const data = new FormData(e.target);
        const value = Object.fromEntries(data.entries());
        value.metrics = data.getAll("metrics");
        valueString = JSON.stringify(value);
        fs.writeFile("METRICS", valueString, function(err, result) {
            if(err) {
                console.log('error writing file')
            };
        });
    };
}

const form = document.querySelector('form');
form.addEventListener('submit', handleSubmit);

document.addEventListener("DOMContentLoaded", function() {
    document.getElementById("dropdown").addEventListener("change", function() {
        var selectedOption = this.value;
        console.log("Selected option: " + selectedOption);
    });
});




</script>
</html>
