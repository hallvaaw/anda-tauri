<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Automated Neuronal Differentiation Analyzer</title>
    <link rel="stylesheet" href="imageAnalysisStyle.css">
</head>
<body>
    <h1>Perform image analysis</h1>
    <form id="form">
        <div>
            <input id="file" class="inputfile" type="file" name="file">
            <label id="inputfile-label" for="file">Add cell line...</label>
            <span id="filename"></span>
            <!--input id="file" class="inputfile" type="file" name="file">
            <label id="inputfile-label" for="file">Add cell line...</label>
            <span id="filename"></span-->
        </div>
        <div class="grid ar">
            <label for="aspect-ratio">Neurite aspect ratio</label>
            <input id="aspect_ratio" class="number-input" name="aspect-ratio" min=0 type="number" onfocus="clearInput(this)" onfocusout="refillInput(this)" value=0>
        </div>
        <div class="checkboxes">
            <!--div class="checkline">
                <input class="checkbox" type="checkbox" name="metrics" value="neurite-lengths">
                <label class="checklabel" for="neurite-lengths">Neurite lengths</label>
            </div>
            <div class="checkline">
                <input class="checkbox" type="checkbox" name="metrics" value="cell-count">
                <label class="checklabel" for="cell-count">Cell body count</label>
            </div>
            <div class="checkline">
                <input class="checkbox" type="checkbox" name="metrics" value="neurite-attachment">
                <label class="checklabel" for="neurite-attachment">Neurite attachment points</label-->
            </div>
            <div id="watershed" class="checkline">
                <input class="checkbox" type="checkbox" name="metrics" value="apply-watershed">
                <label class="checklabel" for="apply-watershed">Apply watershed segmentation</label>
            </div>
            <div class="checkline">
                <input class="checkbox" type="checkbox" name="metrics" value="save-outlines">
                <label class="checklabel" for="save-outlines">Save motif outlines</label>
            </div>
            <div class="btns">
                <a id="cancel" class="btn" href="index.html">Cancel</a>
                <a id="submit" class="btn" type="submit">Submit</a>
                <input type="button" id="save-button" value="Save JSON">
                <button type="submit">submit</button>
            </div>
        </div>
    </form>
</body>
<script>

const fs = window.__TAURI__.fs
const readFile = fs.readTextFile
const readDir = fs.readDir

function clearInput(e) {
    if (e.value == "0") {
        e.value = "";
    }
}

function refillInput(e) {
    if (e.value == "") {
        e.value = "0";
    }
}

// Read cell parameters
async function handleContents(e) {
    const contents = await readFile(e);
    console.log(contents);
}

const output = document.querySelector("span");
const fileReader = document.getElementById("file");
fileReader.addEventListener("change", (event) => {
    // const fileName = event.target.file;
    let fileName = fileReader.files[0].name;
    if (fileName.includes(".json")) {
        output.textContent = fileName;
        handleContents(fileName);
    } else {
        output.textContent = 'Error: file must be JSON format!';
    }
})



// const imageDir = document.getElementById('image-dir');
// imageDir.addEventListener('click', handleContents);

// Write image analysis parameters
function handleSubmit(e) {
    e.preventDefault();
    const data = new FormData(e.target);
    const value = Object.fromEntries(data.entries());
    value.metrics = data.getAll("metrics");
    valueString = JSON.stringify(value);
    fs.writeFile("PATH", valueString, function(err, result) {
        if(err) {
            console.log('error writing file')
        };
    });
}

const form = document.getElementById('form');
form.addEventListener('submit', handleSubmit);

</script>
</html>
